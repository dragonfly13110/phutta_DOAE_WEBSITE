<!-- üå§Ô∏è WEATHER WIDGET - ‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏° -->
<!-- ‡πÉ‡∏ä‡πâ Open-Meteo API (‡∏ü‡∏£‡∏µ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ API Key) -->
<!-- ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö WordPress Shortcode Plugin -->

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@200;300;400;500;600;700;800&display=swap"
    rel="stylesheet">

<style>
    .nkp-weather * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Kanit', sans-serif;
    }

    .nkp-weather {
        background: linear-gradient(135deg, #0f2027 0%, #203a43 40%, #2c5364 100%);
        padding: 40px 20px 50px;
        position: relative;
        overflow: hidden;
        min-height: 400px;
    }

    /* ‚ïê‚ïê‚ïê Animated Stars Background ‚ïê‚ïê‚ïê */
    .nkp-stars {
        position: absolute;
        inset: 0;
        pointer-events: none;
        overflow: hidden;
    }

    .nkp-star {
        position: absolute;
        width: 2px;
        height: 2px;
        background: white;
        border-radius: 50%;
        animation: nkpTwinkle 3s ease-in-out infinite;
    }

    .nkp-star:nth-child(1) {
        top: 8%;
        left: 12%;
        animation-delay: 0s;
    }

    .nkp-star:nth-child(2) {
        top: 15%;
        left: 45%;
        animation-delay: 0.5s;
        width: 3px;
        height: 3px;
    }

    .nkp-star:nth-child(3) {
        top: 22%;
        left: 78%;
        animation-delay: 1s;
    }

    .nkp-star:nth-child(4) {
        top: 5%;
        left: 65%;
        animation-delay: 1.5s;
        width: 3px;
        height: 3px;
    }

    .nkp-star:nth-child(5) {
        top: 30%;
        left: 30%;
        animation-delay: 2s;
    }

    .nkp-star:nth-child(6) {
        top: 12%;
        left: 90%;
        animation-delay: 0.8s;
    }

    .nkp-star:nth-child(7) {
        top: 28%;
        left: 55%;
        animation-delay: 1.3s;
        width: 3px;
        height: 3px;
    }

    .nkp-star:nth-child(8) {
        top: 3%;
        left: 35%;
        animation-delay: 2.2s;
    }

    @keyframes nkpTwinkle {

        0%,
        100% {
            opacity: 0.2;
            transform: scale(1);
        }

        50% {
            opacity: 1;
            transform: scale(1.5);
        }
    }

    /* ‚ïê‚ïê‚ïê Floating Orbs ‚ïê‚ïê‚ïê */
    .nkp-orb {
        position: absolute;
        border-radius: 50%;
        filter: blur(60px);
        pointer-events: none;
        z-index: 1;
    }

    .nkp-orb-1 {
        width: 300px;
        height: 300px;
        background: radial-gradient(circle, rgba(255, 193, 7, 0.12), transparent);
        top: -80px;
        right: -60px;
        animation: nkpOrbFloat 12s ease-in-out infinite;
    }

    .nkp-orb-2 {
        width: 250px;
        height: 250px;
        background: radial-gradient(circle, rgba(33, 150, 243, 0.1), transparent);
        bottom: -80px;
        left: -50px;
        animation: nkpOrbFloat 15s ease-in-out infinite reverse;
    }

    .nkp-orb-3 {
        width: 180px;
        height: 180px;
        background: radial-gradient(circle, rgba(76, 175, 80, 0.08), transparent);
        top: 50%;
        left: 50%;
        animation: nkpOrbFloat 10s ease-in-out infinite 2s;
    }

    @keyframes nkpOrbFloat {

        0%,
        100% {
            transform: translate(0, 0) scale(1);
        }

        33% {
            transform: translate(20px, -15px) scale(1.05);
        }

        66% {
            transform: translate(-15px, 10px) scale(0.95);
        }
    }

    /* ‚ïê‚ïê‚ïê Container ‚ïê‚ïê‚ïê */
    .nkp-container {
        max-width: 800px;
        width: 100%;
        margin: 0 auto;
        position: relative;
        z-index: 10;
    }

    /* ‚ïê‚ïê‚ïê Header ‚ïê‚ïê‚ïê */
    .nkp-header {
        text-align: center;
        margin-bottom: 30px;
        animation: nkpFadeUp 0.8s ease both;
    }

    .nkp-badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.15);
        padding: 5px 16px;
        border-radius: 50px;
        color: rgba(255, 255, 255, 0.8);
        font-size: 12px;
        font-weight: 400;
        letter-spacing: 1px;
        text-transform: uppercase;
        margin-bottom: 12px;
    }

    .nkp-header h2 {
        color: white;
        font-size: 32px;
        font-weight: 700;
        margin-bottom: 6px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .nkp-header p {
        color: rgba(255, 255, 255, 0.6);
        font-size: 14px;
        font-weight: 300;
    }

    @keyframes nkpFadeUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }

        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* ‚ïê‚ïê‚ïê Loading State ‚ïê‚ïê‚ïê */
    .nkp-loading {
        text-align: center;
        padding: 60px 20px;
        color: rgba(255, 255, 255, 0.7);
        font-size: 16px;
    }

    .nkp-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(255, 255, 255, 0.15);
        border-top-color: #ffc107;
        border-radius: 50%;
        margin: 0 auto 15px;
        animation: nkpSpin 0.8s linear infinite;
    }

    @keyframes nkpSpin {
        to {
            transform: rotate(360deg);
        }
    }

    /* ‚ïê‚ïê‚ïê Main Weather Card ‚ïê‚ïê‚ïê */
    .nkp-main-card {
        background: rgba(255, 255, 255, 0.08);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.12);
        border-radius: 24px;
        padding: 30px;
        margin-bottom: 20px;
        animation: nkpFadeUp 0.8s ease 0.1s both;
        position: relative;
        overflow: hidden;
    }

    .nkp-main-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, #ffc107, #ff9800, #ff5722, #ff9800, #ffc107);
        background-size: 200% 100%;
        animation: nkpAccent 4s linear infinite;
    }

    @keyframes nkpAccent {
        0% {
            background-position: 0% 0;
        }

        100% {
            background-position: 200% 0;
        }
    }

    .nkp-current {
        display: flex;
        align-items: center;
        gap: 25px;
    }

    .nkp-temp-block {
        text-align: center;
        flex-shrink: 0;
    }

    .nkp-weather-icon {
        font-size: 64px;
        line-height: 1;
        margin-bottom: 5px;
        filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        animation: nkpIconBounce 3s ease-in-out infinite;
    }

    @keyframes nkpIconBounce {

        0%,
        100% {
            transform: translateY(0);
        }

        50% {
            transform: translateY(-6px);
        }
    }

    .nkp-temp {
        font-size: 56px;
        font-weight: 800;
        color: white;
        line-height: 1;
        text-shadow: 0 2px 15px rgba(255, 193, 7, 0.3);
    }

    .nkp-temp span {
        font-size: 28px;
        font-weight: 300;
        color: rgba(255, 255, 255, 0.6);
        vertical-align: top;
    }

    .nkp-condition {
        color: #ffc107;
        font-size: 16px;
        font-weight: 500;
        margin-top: 4px;
    }

    .nkp-details {
        flex: 1;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
    }

    .nkp-detail-item {
        background: rgba(255, 255, 255, 0.06);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 14px;
        padding: 14px;
        text-align: center;
        transition: all 0.3s ease;
    }

    .nkp-detail-item:hover {
        background: rgba(255, 255, 255, 0.12);
        transform: translateY(-2px);
    }

    .nkp-detail-icon {
        font-size: 22px;
        margin-bottom: 4px;
    }

    .nkp-detail-value {
        color: white;
        font-size: 18px;
        font-weight: 600;
    }

    .nkp-detail-label {
        color: rgba(255, 255, 255, 0.5);
        font-size: 11px;
        font-weight: 300;
        letter-spacing: 0.5px;
    }

    /* ‚ïê‚ïê‚ïê Forecast Cards ‚ïê‚ïê‚ïê */
    .nkp-forecast-title {
        color: rgba(255, 255, 255, 0.7);
        font-size: 13px;
        font-weight: 500;
        letter-spacing: 1px;
        text-transform: uppercase;
        margin-bottom: 12px;
        padding-left: 5px;
        animation: nkpFadeUp 0.8s ease 0.2s both;
    }

    .nkp-forecast {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 10px;
        animation: nkpFadeUp 0.8s ease 0.3s both;
    }

    .nkp-day-card {
        background: rgba(255, 255, 255, 0.07);
        backdrop-filter: blur(15px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 18px;
        padding: 16px 10px;
        text-align: center;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .nkp-day-card:hover {
        background: rgba(255, 255, 255, 0.14);
        transform: translateY(-5px) scale(1.03);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    }

    .nkp-day-name {
        color: rgba(255, 255, 255, 0.6);
        font-size: 12px;
        font-weight: 400;
        margin-bottom: 8px;
    }

    .nkp-day-icon {
        font-size: 32px;
        margin-bottom: 8px;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
    }

    .nkp-day-temps {
        display: flex;
        justify-content: center;
        gap: 6px;
        align-items: baseline;
    }

    .nkp-day-max {
        color: white;
        font-size: 16px;
        font-weight: 600;
    }

    .nkp-day-min {
        color: rgba(255, 255, 255, 0.4);
        font-size: 13px;
        font-weight: 300;
    }

    .nkp-day-rain {
        color: #64b5f6;
        font-size: 11px;
        font-weight: 400;
        margin-top: 5px;
    }

    /* ‚ïê‚ïê‚ïê Update Info ‚ïê‚ïê‚ïê */
    .nkp-update-info {
        text-align: center;
        margin-top: 20px;
        color: rgba(255, 255, 255, 0.35);
        font-size: 11px;
        font-weight: 300;
        animation: nkpFadeUp 0.8s ease 0.4s both;
    }

    .nkp-update-info a {
        color: rgba(255, 255, 255, 0.5);
        text-decoration: none;
        border-bottom: 1px dotted rgba(255, 255, 255, 0.3);
        transition: color 0.3s;
    }

    .nkp-update-info a:hover {
        color: #ffc107;
    }

    /* ‚ïê‚ïê‚ïê Error State ‚ïê‚ïê‚ïê */
    .nkp-error {
        text-align: center;
        padding: 40px 20px;
        color: rgba(255, 255, 255, 0.7);
    }

    .nkp-error-icon {
        font-size: 48px;
        margin-bottom: 12px;
    }

    .nkp-error p {
        font-size: 14px;
        margin-bottom: 15px;
    }

    .nkp-retry-btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 10px 24px;
        background: rgba(255, 193, 7, 0.2);
        border: 1px solid rgba(255, 193, 7, 0.3);
        color: #ffc107;
        border-radius: 50px;
        font-family: 'Kanit', sans-serif;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .nkp-retry-btn:hover {
        background: rgba(255, 193, 7, 0.3);
        transform: translateY(-2px);
    }

    /* ‚ïê‚ïê‚ïê Responsive ‚ïê‚ïê‚ïê */
    @media (max-width: 600px) {
        .nkp-weather {
            padding: 30px 15px 40px;
        }

        .nkp-header h2 {
            font-size: 24px;
        }

        .nkp-current {
            flex-direction: column;
            text-align: center;
        }

        .nkp-temp {
            font-size: 48px;
        }

        .nkp-weather-icon {
            font-size: 52px;
        }

        .nkp-details {
            grid-template-columns: 1fr 1fr;
        }

        .nkp-forecast {
            grid-template-columns: repeat(5, 1fr);
            gap: 6px;
        }

        .nkp-day-card {
            padding: 12px 6px;
            border-radius: 14px;
        }

        .nkp-day-icon {
            font-size: 24px;
        }

        .nkp-day-max {
            font-size: 14px;
        }

        .nkp-day-min {
            font-size: 11px;
        }

        .nkp-main-card {
            padding: 20px;
        }
    }

    @media (max-width: 400px) {
        .nkp-forecast {
            grid-template-columns: repeat(3, 1fr);
        }
    }
</style>

<section class="nkp-weather">
    <!-- Background Effects -->
    <div class="nkp-stars">
        <div class="nkp-star"></div>
        <div class="nkp-star"></div>
        <div class="nkp-star"></div>
        <div class="nkp-star"></div>
        <div class="nkp-star"></div>
        <div class="nkp-star"></div>
        <div class="nkp-star"></div>
        <div class="nkp-star"></div>
    </div>
    <div class="nkp-orb nkp-orb-1"></div>
    <div class="nkp-orb nkp-orb-2"></div>
    <div class="nkp-orb nkp-orb-3"></div>

    <div class="nkp-container">
        <!-- Header -->
        <div class="nkp-header">
            <div class="nkp-badge">üåæ ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏û‡∏∏‡∏ó‡∏ò‡∏°‡∏ì‡∏ë‡∏•</div>
            <h2>üå§Ô∏è ‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°</h2>
            <p>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÅ‡∏ö‡∏ö Real-time ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£</p>
        </div>

        <!-- Content Area (JS will populate this) -->
        <div id="nkp-weather-content">
            <div class="nkp-loading">
                <div class="nkp-spinner"></div>
                <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®...</p>
            </div>
        </div>
    </div>
</section>

<script>
    (function () {
        // Nakhon Pathom coordinates
        const LAT = 13.8196;
        const LON = 100.0614;

        // Thai day names
        const THAI_DAYS = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏Ø', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'];
        const THAI_SHORT_DAYS = ['‡∏≠‡∏≤.', '‡∏à.', '‡∏≠.', '‡∏û.', '‡∏û‡∏§.', '‡∏®.', '‡∏™.'];

        // Weather code to emoji + description (WMO codes)
        function getWeatherInfo(code) {
            const map = {
                0: { icon: '‚òÄÔ∏è', desc: '‡∏ó‡πâ‡∏≠‡∏á‡∏ü‡πâ‡∏≤‡πÅ‡∏à‡πà‡∏°‡πÉ‡∏™' },
                1: { icon: 'üå§Ô∏è', desc: '‡∏ó‡πâ‡∏≠‡∏á‡∏ü‡πâ‡∏≤‡∏Ñ‡πà‡∏≠‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡πÅ‡∏à‡πà‡∏°‡πÉ‡∏™' },
                2: { icon: '‚õÖ', desc: '‡∏°‡∏µ‡πÄ‡∏°‡∏Ü‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô' },
                3: { icon: '‚òÅÔ∏è', desc: '‡πÄ‡∏°‡∏Ü‡∏°‡∏≤‡∏Å' },
                45: { icon: 'üå´Ô∏è', desc: '‡∏´‡∏°‡∏≠‡∏Å' },
                48: { icon: 'üå´Ô∏è', desc: '‡∏´‡∏°‡∏≠‡∏Å‡∏ô‡πâ‡∏≥‡∏Ñ‡πâ‡∏≤‡∏á‡πÅ‡∏Ç‡πá‡∏á' },
                51: { icon: 'üå¶Ô∏è', desc: '‡∏ù‡∏ô‡∏•‡∏∞‡∏≠‡∏≠‡∏á‡πÄ‡∏ö‡∏≤‡∏ö‡∏≤‡∏á' },
                53: { icon: 'üå¶Ô∏è', desc: '‡∏ù‡∏ô‡∏•‡∏∞‡∏≠‡∏≠‡∏á' },
                55: { icon: 'üåßÔ∏è', desc: '‡∏ù‡∏ô‡∏•‡∏∞‡∏≠‡∏≠‡∏á‡∏´‡∏ô‡∏±‡∏Å' },
                61: { icon: 'üåßÔ∏è', desc: '‡∏ù‡∏ô‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢' },
                63: { icon: 'üåßÔ∏è', desc: '‡∏ù‡∏ô‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á' },
                65: { icon: 'üåßÔ∏è', desc: '‡∏ù‡∏ô‡∏ï‡∏Å‡∏´‡∏ô‡∏±‡∏Å' },
                71: { icon: 'üå®Ô∏è', desc: '‡∏´‡∏¥‡∏°‡∏∞‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢' },
                73: { icon: 'üå®Ô∏è', desc: '‡∏´‡∏¥‡∏°‡∏∞‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á' },
                75: { icon: 'üå®Ô∏è', desc: '‡∏´‡∏¥‡∏°‡∏∞‡∏ï‡∏Å‡∏´‡∏ô‡∏±‡∏Å' },
                80: { icon: 'üå¶Ô∏è', desc: '‡∏ù‡∏ô‡∏ï‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏¢‡∏∞' },
                81: { icon: 'üåßÔ∏è', desc: '‡∏ù‡∏ô‡∏ï‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏¢‡∏∞ ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á' },
                82: { icon: '‚õàÔ∏è', desc: '‡∏ù‡∏ô‡∏ï‡∏Å‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏¢‡∏∞' },
                95: { icon: '‚õàÔ∏è', desc: '‡∏û‡∏≤‡∏¢‡∏∏‡∏ù‡∏ô‡∏ü‡πâ‡∏≤‡∏Ñ‡∏∞‡∏ô‡∏≠‡∏á' },
                96: { icon: '‚õàÔ∏è', desc: '‡∏û‡∏≤‡∏¢‡∏∏‡∏ù‡∏ô‡∏ü‡πâ‡∏≤‡∏Ñ‡∏∞‡∏ô‡∏≠‡∏á + ‡∏•‡∏π‡∏Å‡πÄ‡∏´‡πá‡∏ö' },
                99: { icon: '‚õàÔ∏è', desc: '‡∏û‡∏≤‡∏¢‡∏∏‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á + ‡∏•‡∏π‡∏Å‡πÄ‡∏´‡πá‡∏ö' }
            };
            return map[code] || { icon: 'üå°Ô∏è', desc: '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞' };
        }

        // Wind direction from degrees
        function getWindDir(deg) {
            const dirs = ['‡πÄ‡∏´‡∏ô‡∏∑‡∏≠', '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠', '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å', '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÉ‡∏ï‡πâ', '‡πÉ‡∏ï‡πâ', '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÉ‡∏ï‡πâ', '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å', '‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠'];
            return dirs[Math.round(deg / 45) % 8];
        }

        // UV Level
        function getUVLevel(uv) {
            if (uv <= 2) return { text: '‡∏ï‡πà‡∏≥', color: '#4caf50' };
            if (uv <= 5) return { text: '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á', color: '#ffc107' };
            if (uv <= 7) return { text: '‡∏™‡∏π‡∏á', color: '#ff9800' };
            if (uv <= 10) return { text: '‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å', color: '#f44336' };
            return { text: '‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢', color: '#9c27b0' };
        }

        // Fetch weather data
        function fetchWeather() {
            var apiUrl = 'https://api.open-meteo.com/v1/forecast?latitude=' + LAT + '&longitude=' + LON +
                '&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m,wind_direction_10m' +
                '&daily=weather_code,temperature_2m_max,temperature_2m_min,uv_index_max,precipitation_probability_max' +
                '&timezone=Asia%2FBangkok&forecast_days=6';

            var xhr = new XMLHttpRequest();
            xhr.open('GET', apiUrl, true);
            xhr.onload = function () {
                if (xhr.status === 200) {
                    try {
                        var data = JSON.parse(xhr.responseText);
                        renderWeather(data);
                    } catch (e) {
                        renderError();
                    }
                } else {
                    renderError();
                }
            };
            xhr.onerror = function () {
                renderError();
            };
            xhr.send();
        }

        // Render weather data
        function renderWeather(data) {
            var c = data.current;
            var d = data.daily;
            var weatherInfo = getWeatherInfo(c.weather_code);
            var uvData = d.uv_index_max ? getUVLevel(d.uv_index_max[0]) : { text: '-', color: '#fff' };
            var windDir = getWindDir(c.wind_direction_10m);

            var now = new Date();
            var timeStr = now.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
            var dateStr = '‡∏ß‡∏±‡∏ô' + THAI_DAYS[now.getDay()] + '‡∏ó‡∏µ‡πà ' + now.getDate() + '/' + (now.getMonth() + 1) + '/' + (now.getFullYear() + 543);

            var html = '';

            // Main card
            html += '<div class="nkp-main-card">';
            html += '  <div class="nkp-current">';
            html += '    <div class="nkp-temp-block">';
            html += '      <div class="nkp-weather-icon">' + weatherInfo.icon + '</div>';
            html += '      <div class="nkp-temp">' + Math.round(c.temperature_2m) + '<span>¬∞C</span></div>';
            html += '      <div class="nkp-condition">' + weatherInfo.desc + '</div>';
            html += '    </div>';
            html += '    <div class="nkp-details">';
            html += '      <div class="nkp-detail-item">';
            html += '        <div class="nkp-detail-icon">üå°Ô∏è</div>';
            html += '        <div class="nkp-detail-value">' + c.apparent_temperature.toFixed(1) + '¬∞</div>';
            html += '        <div class="nkp-detail-label">‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô</div>';
            html += '      </div>';
            html += '      <div class="nkp-detail-item">';
            html += '        <div class="nkp-detail-icon">üíß</div>';
            html += '        <div class="nkp-detail-value">' + c.relative_humidity_2m + '%</div>';
            html += '        <div class="nkp-detail-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏∑‡πâ‡∏ô</div>';
            html += '      </div>';
            html += '      <div class="nkp-detail-item">';
            html += '        <div class="nkp-detail-icon">üí®</div>';
            html += '        <div class="nkp-detail-value">' + Math.round(c.wind_speed_10m) + ' km/h</div>';
            html += '        <div class="nkp-detail-label">‡∏•‡∏° ' + windDir + '</div>';
            html += '      </div>';
            html += '      <div class="nkp-detail-item">';
            html += '        <div class="nkp-detail-icon">‚òÄÔ∏è</div>';
            html += '        <div class="nkp-detail-value" style="color:' + uvData.color + '">' + (d.uv_index_max ? d.uv_index_max[0].toFixed(1) : '-') + '</div>';
            html += '        <div class="nkp-detail-label">UV ' + uvData.text + '</div>';
            html += '      </div>';
            html += '    </div>';
            html += '  </div>';
            html += '</div>';

            // Forecast
            html += '<div class="nkp-forecast-title">üìÖ ‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå 5 ‡∏ß‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤</div>';
            html += '<div class="nkp-forecast">';

            for (var i = 1; i <= 5; i++) {
                if (d.time[i]) {
                    var fDate = new Date(d.time[i] + 'T00:00:00');
                    var dayName = THAI_SHORT_DAYS[fDate.getDay()];
                    var fWeather = getWeatherInfo(d.weather_code[i]);
                    var rainProb = d.precipitation_probability_max ? d.precipitation_probability_max[i] : 0;

                    html += '<div class="nkp-day-card">';
                    html += '  <div class="nkp-day-name">' + dayName + '</div>';
                    html += '  <div class="nkp-day-icon">' + fWeather.icon + '</div>';
                    html += '  <div class="nkp-day-temps">';
                    html += '    <span class="nkp-day-max">' + Math.round(d.temperature_2m_max[i]) + '¬∞</span>';
                    html += '    <span class="nkp-day-min">' + Math.round(d.temperature_2m_min[i]) + '¬∞</span>';
                    html += '  </div>';
                    if (rainProb > 0) {
                        html += '  <div class="nkp-day-rain">üíß ' + rainProb + '%</div>';
                    }
                    html += '</div>';
                }
            }

            html += '</div>';

            // Update info
            html += '<div class="nkp-update-info">';
            html += '  üìç ‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏° | ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: ' + dateStr + ' ‡πÄ‡∏ß‡∏•‡∏≤ ' + timeStr + ' ‡∏ô.';
            html += '  | ‡πÅ‡∏´‡∏•‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: <a href="https://open-meteo.com/" target="_blank">Open-Meteo</a>';
            html += '</div>';

            document.getElementById('nkp-weather-content').innerHTML = html;
        }

        // Render error
        function renderError() {
            var html = '<div class="nkp-error">';
            html += '  <div class="nkp-error-icon">‚ö†Ô∏è</div>';
            html += '  <p>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÑ‡∏î‡πâ<br>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï</p>';
            html += '  <button class="nkp-retry-btn" onclick="location.reload()">üîÑ ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>';
            html += '</div>';
            document.getElementById('nkp-weather-content').innerHTML = html;
        }

        // Console log for shortcode test
        console.log('üå§Ô∏è Nakhon Pathom Weather Widget: Script Loaded');

        // Start fetching
        fetchWeather();
    })();
</script>